from core.name_convention import *
from core.util import get_wavelengths_for
import numpy as np
import torch


class Normalize(object):
    def __init__(self, camera_type: CameraType):
        self.camera_type = camera_type

        self.mean, self.std = self.load_properties(self.camera_type)

    def load_properties(self, camera_type: CameraType):
        if camera_type == CameraType.VIS:
            mean = [0.12598258, 0.11915004, 0.11136916, 0.10434598, 0.09089279, 0.07895034, 0.07036217, 0.06450803,
                    0.05950985, 0.05612756, 0.05305031, 0.0505252, 0.0484633, 0.04674273, 0.04542638, 0.04437403,
                    0.0429998, 0.0426232, 0.04218608, 0.04150986, 0.04145793, 0.04123529, 0.04075775, 0.04047884,
                    0.04061749, 0.0402243, 0.03986504, 0.03992241, 0.03962446, 0.03964433, 0.03968308, 0.03969406,
                    0.03973917, 0.04009605, 0.04021379, 0.0403146, 0.04097591, 0.0412912, 0.04155774, 0.04178999,
                    0.04249243, 0.04313103, 0.04376722, 0.04457876, 0.04559356, 0.04663794, 0.04769102, 0.04889106,
                    0.05034733, 0.05165369, 0.05301042, 0.0544414, 0.05593583, 0.05728107, 0.05867109, 0.06004295,
                    0.06151129, 0.06254386, 0.06407835, 0.06529062, 0.06654429, 0.06744876, 0.06850592, 0.06938997,
                    0.07021867, 0.070861, 0.07131809, 0.07188864, 0.07267585, 0.07352533, 0.07419479, 0.07488593,
                    0.07586224, 0.07680982, 0.07770976, 0.07856321, 0.07960681, 0.08066987, 0.08181008, 0.08273049,
                    0.08343837, 0.08415748, 0.08475561, 0.08529092, 0.08607904, 0.08672315, 0.08756292, 0.08870944,
                    0.08981079, 0.09060997, 0.09084439, 0.09063615, 0.09024067, 0.08984669, 0.0895173, 0.08934435,
                    0.08928358, 0.089335, 0.0895573, 0.08997512, 0.09028541, 0.09120258, 0.09117471, 0.09133232,
                    0.0919726, 0.09316511, 0.09507585, 0.09770387, 0.10149504, 0.10629631, 0.11243455, 0.12168135,
                    0.13315186, 0.14649014, 0.16234376, 0.17846502, 0.19220723, 0.20394711, 0.21440068, 0.22524412,
                    0.23599711, 0.24642685, 0.25547323, 0.26372084, 0.27137384, 0.27981275, 0.28792545, 0.2952477,
                    0.30016813, 0.3044302, 0.3085245, 0.31209016, 0.3154594, 0.31853992, 0.32175922, 0.32468787,
                    0.32730955, 0.32958236, 0.33155948, 0.33302107, 0.3341355, 0.33505026, 0.3364046, 0.33804607,
                    0.34001526, 0.34224838, 0.34439793, 0.3463192, 0.34786195, 0.3489478, 0.34990945, 0.35090363,
                    0.3522856, 0.35382256, 0.3555193, 0.3572152, 0.35855123, 0.3596513, 0.36047474, 0.36074415,
                    0.36043003, 0.35974735, 0.35933936, 0.35922512, 0.35940772, 0.35999206, 0.36058933, 0.36127883,
                    0.36185926, 0.36244372, 0.36300045, 0.3635316, 0.36376628, 0.36403042, 0.36401412, 0.36400145,
                    0.3637505, 0.36355367, 0.36327296, 0.36323345, 0.3628942, 0.3628446, 0.36254373, 0.36241177,
                    0.36199975, 0.3615831, 0.3611562, 0.36061445, 0.35977516, 0.35881397, 0.35764232, 0.3565369,
                    0.35543197, 0.35399148, 0.3523226, 0.34995127, 0.3468776, 0.34385115, 0.340087, 0.33636603,
                    0.3321134, 0.3277462, 0.3224932, 0.3170271, 0.31126255, 0.30523607, 0.29938403, 0.2940384,
                    0.29033172, 0.2881571, 0.2868844, 0.2856689, 0.2851532, 0.28401688, 0.2839323, 0.28393912,
                    0.28443953, 0.28475162, 0.285802, 0.28641447, 0.28754735, 0.2882395, 0.28949064, 0.29107296]

            std = [0.13837524, 0.13349141, 0.12440519, 0.10866302, 0.08931413, 0.07345333, 0.0620609, 0.05465464,
                   0.04909426, 0.04574274, 0.04310585, 0.04010559, 0.03786773, 0.03625838, 0.03458701, 0.0335575,
                   0.032343, 0.0318469, 0.03119958, 0.0305734, 0.03053295, 0.03031413, 0.02994966, 0.02988187,
                   0.03005593, 0.02959596, 0.02945146, 0.02956043, 0.02934882, 0.02928529, 0.02934058, 0.02937599,
                   0.0293457, 0.0296166, 0.02967709, 0.02977737, 0.03003769, 0.03024806, 0.03041479, 0.03061198,
                   0.03102757, 0.03144221, 0.03186877, 0.03244498, 0.03312024, 0.03388086, 0.03469204, 0.03554787,
                   0.03656504, 0.03754272, 0.0385096, 0.03955771, 0.04052059, 0.04145289, 0.04241385, 0.04328721,
                   0.04418783, 0.04495647, 0.04594798, 0.04674179, 0.04748167, 0.04809199, 0.04873918, 0.04927874,
                   0.04970138, 0.04999785, 0.05020925, 0.05052797, 0.05094601, 0.05132979, 0.05166472, 0.05207153,
                   0.05265929, 0.05323046, 0.05372607, 0.05418697, 0.05480026, 0.05544403, 0.05611565, 0.05662267,
                   0.05697913, 0.05730052, 0.05761143, 0.05790713, 0.05828464, 0.05862219, 0.05912714, 0.05984953,
                   0.0604958, 0.06091835, 0.06093742, 0.06065084, 0.06024275, 0.05982826, 0.05948057, 0.05920459,
                   0.05903713, 0.05898121, 0.05903718, 0.05920248, 0.05934142, 0.05992735, 0.05971091, 0.05969353,
                   0.06001863, 0.06074755, 0.06194106, 0.06360092, 0.06615506, 0.06942739, 0.07359663, 0.0800553,
                   0.08819394, 0.09768552, 0.10911371, 0.12052148, 0.13026787, 0.13865192, 0.14610821, 0.15390167,
                   0.16160728, 0.16906628, 0.17552815, 0.18137458, 0.18674769, 0.19269896, 0.19844475, 0.2035848,
                   0.20686571, 0.20967042, 0.21253848, 0.21503772, 0.2173394, 0.21947187, 0.2215841, 0.22356148,
                   0.22533353, 0.22671966, 0.22781159, 0.22860542, 0.2292168, 0.22980683, 0.23065372, 0.23166321,
                   0.23291498, 0.23424484, 0.23555371, 0.23669942, 0.23759526, 0.23826826, 0.23883095, 0.23944092,
                   0.24029198, 0.24121839, 0.24224032, 0.24325638, 0.24404548, 0.24465309, 0.24503063, 0.24508576,
                   0.24475484, 0.24422066, 0.24379997, 0.24362381, 0.24367373, 0.24394785, 0.24423924, 0.24459149,
                   0.24492192, 0.24523343, 0.24548614, 0.24569039, 0.24579844, 0.24586459, 0.24581307, 0.24572136,
                   0.2454934, 0.24530382, 0.2451207, 0.24497035, 0.24476346, 0.24455726, 0.24438164, 0.2442023,
                   0.24391526, 0.24359739, 0.24329668, 0.2428024, 0.24223521, 0.24151057, 0.2406576, 0.23979683,
                   0.23903537, 0.23812273, 0.23694326, 0.23528816, 0.23321383, 0.23102799, 0.22854099, 0.22591934,
                   0.22292723, 0.21981409, 0.21620542, 0.21233866, 0.20839053, 0.2043073, 0.20025419, 0.19653335,
                   0.1939793, 0.19253406, 0.19167478, 0.19077323, 0.19035004, 0.18967433, 0.1896462, 0.18966739,
                   0.19007014, 0.19049235, 0.19111782, 0.19176109, 0.1927388, 0.19336107, 0.19446602, 0.19598487]

            return mean, std
        elif camera_type == CameraType.NIR:
            mean = [0.25246843695640564, 0.20367072522640228, 0.23449595272541046, 0.26059335470199585,
                    0.2527230978012085, 0.25772014260292053, 0.26779550313949585, 0.29485949873924255,
                    0.3150586187839508, 0.3822185695171356, 0.3507082462310791, 0.372749924659729,
                    0.36660832166671753, 0.36228692531585693, 0.3569612205028534, 0.3600204586982727,
                    0.3595893085002899, 0.35958319902420044, 0.3600192666053772, 0.3607463538646698,
                    0.362000435590744, 0.36355602741241455, 0.3655463457107544, 0.3676984906196594,
                    0.37012016773223877, 0.37257713079452515, 0.375250905752182, 0.37807130813598633,
                    0.3811369836330414, 0.38396868109703064, 0.38704073429107666, 0.3900705575942993,
                    0.3930838406085968, 0.39610666036605835, 0.3992055356502533, 0.40202733874320984,
                    0.4046315550804138, 0.4072176218032837, 0.4095773696899414, 0.4117245674133301,
                    0.4136631488800049, 0.4151330292224884, 0.41658759117126465, 0.41779041290283203,
                    0.41838014125823975, 0.41875284910202026, 0.4188230335712433, 0.41859015822410583,
                    0.4180617332458496, 0.4172356426715851, 0.4161553382873535, 0.4147394895553589,
                    0.41313475370407104, 0.41130056977272034, 0.40918004512786865, 0.4067307710647583,
                    0.4041423499584198, 0.40113580226898193, 0.3978062868118286, 0.3940078914165497,
                    0.38986527919769287, 0.3853277862071991, 0.38027018308639526, 0.37458065152168274,
                    0.3681028187274933, 0.3606296479701996, 0.35220423340797424, 0.3428560793399811,
                    0.333614706993103, 0.3248330354690552, 0.31731176376342773, 0.3109995722770691,
                    0.3063927888870239, 0.3029343783855438, 0.3004623353481293, 0.29856783151626587,
                    0.2972108721733093, 0.2960720956325531, 0.2952919900417328, 0.2944614887237549,
                    0.2938000559806824, 0.2930529713630676, 0.292439728975296, 0.2917446792125702,
                    0.2913435995578766, 0.2911834120750427, 0.29133525490760803, 0.2914484441280365,
                    0.29188111424446106, 0.2923249900341034, 0.2929506301879883, 0.29365548491477966,
                    0.2944844365119934, 0.2953532040119171, 0.29632583260536194, 0.29722246527671814,
                    0.29813656210899353, 0.2989230751991272, 0.2996326982975006, 0.30027052760124207,
                    0.3009365200996399, 0.30149033665657043, 0.30194801092147827, 0.30216631293296814,
                    0.30250978469848633, 0.30250808596611023, 0.3023666739463806, 0.3021002411842346,
                    0.30163028836250305, 0.30091533064842224, 0.30008983612060547, 0.2987985610961914,
                    0.2974887490272522, 0.2957976758480072, 0.29384657740592957, 0.2915194034576416,
                    0.28904247283935547, 0.2860560119152069, 0.2830025255680084, 0.2796124219894409,
                    0.27587583661079407, 0.27190372347831726, 0.2677280604839325, 0.26325923204421997,
                    0.2587939202785492, 0.25427353382110596, 0.2497767060995102, 0.24523712694644928,
                    0.24089576303958893, 0.2367335706949234, 0.23277311027050018, 0.22887329757213593,
                    0.22529630362987518, 0.22178077697753906, 0.21826326847076416, 0.21459835767745972,
                    0.2107025533914566, 0.20629632472991943, 0.20131945610046387, 0.1957404464483261,
                    0.18964596092700958, 0.1830458641052246, 0.1758243292570114, 0.16777285933494568,
                    0.15948672592639923, 0.151448056101799, 0.14416171610355377, 0.13729742169380188,
                    0.13145147264003754, 0.12663030624389648, 0.12270348519086838, 0.11958488821983337,
                    0.11709846556186676, 0.11498712003231049, 0.11331142485141754, 0.11196156591176987,
                    0.11086834967136383, 0.10992196202278137, 0.1091114804148674, 0.10850206762552261,
                    0.1081385388970375, 0.10771704465150833, 0.10744945704936981, 0.10740197449922562,
                    0.10733875632286072, 0.10724395513534546, 0.10732632875442505, 0.10743610560894012,
                    0.10770045965909958, 0.10794396698474884, 0.10845556855201721, 0.10899580270051956,
                    0.1096629872918129, 0.11040083318948746, 0.11121552437543869, 0.11209578067064285,
                    0.11301722377538681, 0.11390651762485504, 0.11495991051197052, 0.11599672585725784,
                    0.11716532707214355, 0.11831463873386383, 0.11956706643104553, 0.12062894552946091,
                    0.1219468042254448, 0.12316345423460007, 0.12447096407413483, 0.12567971646785736,
                    0.1269966959953308, 0.1283010095357895, 0.1296614408493042, 0.1309259980916977,
                    0.13236230611801147, 0.1334831565618515, 0.13474911451339722, 0.13603812456130981,
                    0.13735899329185486, 0.13870784640312195, 0.13999563455581665, 0.14104622602462769,
                    0.14240258932113647, 0.14355836808681488, 0.14484921097755432, 0.14595435559749603,
                    0.14712123572826385, 0.1481814980506897, 0.14934368431568146, 0.15033210813999176,
                    0.15149466693401337, 0.15248599648475647, 0.15365615487098694, 0.1545674353837967,
                    0.1556553840637207, 0.15650126338005066, 0.15745487809181213, 0.15829703211784363,
                    0.159190833568573, 0.1599915772676468, 0.16090744733810425, 0.16159172356128693,
                    0.16234374046325684, 0.16284653544425964, 0.16346895694732666, 0.16393250226974487,
                    0.16450999677181244, 0.16476203501224518, 0.16513954102993011, 0.16534486413002014,
                    0.16574470698833466, 0.1660114824771881, 0.16632576286792755, 0.1664169877767563,
                    0.16643060743808746, 0.1662294566631317, 0.16586488485336304, 0.1649368852376938,
                    0.1645088642835617, 0.16371634602546692, 0.1630546897649765, 0.16154807806015015,
                    0.1600814014673233, 0.15826797485351562, 0.15608979761600494, 0.15369167923927307,
                    0.1511661261320114, 0.14827698469161987, 0.14536917209625244, 0.142444908618927,
                    0.1557874232530594, 0.13524435460567474, 0.1307692527770996, 0.1277199238538742]
            std = [0.25733536, 0.7051073, 0.32068878, 1.1206155, 0.26832762, 0.30502564, 0.23820099, 0.3468461,
                   1.0768355, 1.3225003, 0.4323877, 0.40734583, 0.2646051, 0.22942708, 0.27049178, 0.22519968,
                   0.22497371, 0.2250201, 0.22534208, 0.22586769, 0.2266848, 0.2277435, 0.2289841, 0.23036715,
                   0.23187831, 0.23343562, 0.23514773, 0.23689654, 0.23876567, 0.24056244, 0.24247037, 0.24436007,
                   0.24623597, 0.2481235, 0.25003663, 0.25180152, 0.25343093, 0.2550452, 0.25649136, 0.25783256,
                   0.25901735, 0.2599637, 0.26083386, 0.26157066, 0.26191932, 0.2621681, 0.26220557, 0.26207653,
                   0.26173836, 0.2612314, 0.26053765, 0.25968075, 0.25868613, 0.25754118, 0.25621477, 0.2547651,
                   0.25317755, 0.25129953, 0.24920823, 0.2468689, 0.24426982, 0.24143067, 0.23827448, 0.23472059,
                   0.23068619, 0.2260375, 0.22078814, 0.215031, 0.20930044, 0.20391387, 0.19926526, 0.19538623,
                   0.19250241, 0.19040233, 0.18885842, 0.1876989, 0.18685184, 0.18617973, 0.1856935, 0.18520561,
                   0.18479773, 0.18434358, 0.18393347, 0.18356149, 0.18331781, 0.18321085, 0.18326849, 0.18337184,
                   0.18363117, 0.18390642, 0.18426958, 0.18471073, 0.1852175, 0.18578391, 0.18636838, 0.1869096,
                   0.18746132, 0.18795143, 0.18841228, 0.18880914, 0.18920018, 0.18955049, 0.18982162, 0.18997067,
                   0.19016132, 0.1901677, 0.19009112, 0.1899346, 0.18963341, 0.18920031, 0.18867949, 0.18791975,
                   0.18709248, 0.18606584, 0.18486108, 0.18344449, 0.18191585, 0.1800925, 0.1782015, 0.17612904,
                   0.17383197, 0.17139639, 0.16883221, 0.16610833, 0.16337971, 0.16060951, 0.15785442, 0.15511283,
                   0.15243493, 0.14988288, 0.1474498, 0.14507842, 0.14288382, 0.14073686, 0.138604, 0.1363831,
                   0.13397966, 0.1312616, 0.1282034, 0.12478443, 0.12106017, 0.11704976, 0.11267475, 0.10780761,
                   0.10278689, 0.09791582, 0.0935083, 0.08940312, 0.08588858, 0.08296502, 0.08055043, 0.07863964,
                   0.07709709, 0.07579459, 0.07475055, 0.07391801, 0.073239, 0.07266272, 0.07218111, 0.07181346,
                   0.07158026, 0.07132407, 0.0711707, 0.07113521, 0.07109496, 0.07106862, 0.07111621, 0.07118069,
                   0.07134509, 0.07151295, 0.07182348, 0.07214891, 0.07255574, 0.07301649, 0.07351442, 0.07405931,
                   0.07461775, 0.07515452, 0.07579268, 0.07645085, 0.07714032, 0.07785247, 0.07859575, 0.07925811,
                   0.08004165, 0.0807716, 0.08156711, 0.08231259, 0.08311074, 0.08388123, 0.08469653, 0.0854663,
                   0.0863173, 0.08700226, 0.08776187, 0.08854887, 0.08933183, 0.09013577, 0.09090358, 0.09156618,
                   0.09237044, 0.0930635, 0.09382042, 0.09449296, 0.0952006, 0.09583142, 0.09649963, 0.0971292,
                   0.09782349, 0.09842034, 0.09913459, 0.0997033, 0.10034627, 0.10087726, 0.10143786, 0.10195142,
                   0.10248962, 0.1029707, 0.10348839, 0.10396001, 0.1044193, 0.10470458, 0.10503376, 0.1053434,
                   0.1056041, 0.10577423, 0.10598827, 0.10613247, 0.10637016, 0.10650609, 0.10669192, 0.10679198,
                   0.10682209, 0.10677908, 0.10659397, 0.10616791, 0.10597543, 0.1055592, 0.10539887, 0.1047722,
                   0.10411818, 0.10322235, 0.10222203, 0.10113382, 0.09984302, 0.09866208, 0.09760508, 0.09634618,
                   0.39878017, 0.09598767, 0.09993725, 0.10360683]

            return mean, std

        raise Exception("not defined!!")

    def __call__(self, sample):
        item, label = sample

        item = ((item.numpy().transpose(1, 2, 0) - self.mean) / self.std).transpose(2, 0, 1)

        return torch.from_numpy(item).float(), label
